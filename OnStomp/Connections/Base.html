<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Class: OnStomp::Connections::Base</title>
<link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (B)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../OnStomp.html" title="OnStomp (module)">OnStomp</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Connections.html" title="OnStomp::Connections (module)">Connections</a></span></span>
     &raquo; 
    <span class="title">Base</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: OnStomp::Connections::Base
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">OnStomp::Connections::Base</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="../Interfaces/ConnectionEvents.html" title="OnStomp::Interfaces::ConnectionEvents (module)">Interfaces::ConnectionEvents</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/onstomp/connections/base.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Common behavior for all connections.
</p>


  </div>
</div>
<div class="tags">
  
</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="Stomp_1_0.html" title="OnStomp::Connections::Stomp_1_0 (class)">Stomp_1_0</a></span>, <span class='object_link'><a href="Stomp_1_1.html" title="OnStomp::Connections::Stomp_1_1 (class)">Stomp_1_1</a></span></p>
</div>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="MAX_BYTES_PER_WRITE-constant" class="">MAX_BYTES_PER_WRITE =
          <div class="docstring">
  <div class="discussion">
    <p>
The approximate maximum number of bytes to write per call to
<span class='object_link'><a href="#io_process_write-instance_method" title="OnStomp::Connections::Base#io_process_write (method)">#io_process_write</a></span>.
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='int'>1024</span> <span class='op'>*</span> <span class='int'>8</span></pre></dd>
      
        <dt id="MAX_BYTES_PER_READ-constant" class="">MAX_BYTES_PER_READ =
          <div class="docstring">
  <div class="discussion">
    <p>
The maximum number of bytes to read per call to <span class='object_link'><a href="#io_process_read-instance_method" title="OnStomp::Connections::Base#io_process_read (method)">#io_process_read</a></span>
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='int'>1024</span> <span class='op'>*</span> <span class='int'>4</span></pre></dd>
      
    </dl>
  


  
  
  
  
  
  
  
  
  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#client-instance_method" title="#client (instance method)">- (Object) <strong>client</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute client.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#last_received_at-instance_method" title="#last_received_at (instance method)">- (Object) <strong>last_received_at</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute last_received_at.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#last_transmitted_at-instance_method" title="#last_transmitted_at (instance method)">- (Object) <strong>last_transmitted_at</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute last_transmitted_at.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#socket-instance_method" title="#socket (instance method)">- (Object) <strong>socket</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute socket.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#version-instance_method" title="#version (instance method)">- (Object) <strong>version</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute version.
</p>
</div></span>
  
</li>

    
  </ul>


  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close-instance_method" title="#close (instance method)">- (Object) <strong>close</strong>(blocking = false) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Closes the <span class='object_link'><a href="#socket-instance_method" title="OnStomp::Connections::Base#socket (method)">#socket</a></span>.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#configure-instance_method" title="#configure (instance method)">- (Object) <strong>configure</strong>(connected, con_cbs) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Performs any necessary configuration of the connection from the CONNECTED
frame sent by the broker and a <tt>Hash</tt> of pending callbacks.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connect-instance_method" title="#connect (instance method)">- (Object) <strong>connect</strong>(client, *headers) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Exchanges the CONNECT/CONNECTED frame handshake with the broker and returns
the version detected along with the received CONNECTED frame.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connected%3F-instance_method" title="#connected? (instance method)">- (true, false) <strong>connected?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns true if the socket has not been closed, false otherwise.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#flush_write_buffer-instance_method" title="#flush_write_buffer (instance method)">- (Object) <strong>flush_write_buffer</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Flushes the write buffer by invoking <span class='object_link'><a href="#io_process_write-instance_method" title="OnStomp::Connections::Base#io_process_write (method)">#io_process_write</a></span> until the buffer
is empty.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Base) <strong>initialize</strong>(socket, client) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Creates a new connection using the given <span class='object_link'><a href="#socket-instance_method" title="OnStomp::Connections::Base#socket (method)">#socket</a></span> object and
<span class='object_link'><a href="../Client.html" title="OnStomp::Client (class)">client</a></span>.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#io_process-instance_method" title="#io_process (instance method)">- (Object) <strong>io_process</strong>(&amp;cb) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Makes a single call to <span class='object_link'><a href="#io_process_write-instance_method" title="OnStomp::Connections::Base#io_process_write (method)">#io_process_write</a></span> and a single call to
<span class='object_link'><a href="#io_process_read-instance_method" title="OnStomp::Connections::Base#io_process_read (method)">#io_process_read</a></span>.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#io_process_read-instance_method" title="#io_process_read (instance method)">- (Object) <strong>io_process_read</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Reads serialized frame data from the socket if we&#8217;re connected and
and the socket is ready for reading.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#io_process_write-instance_method" title="#io_process_write (instance method)">- (Object) <strong>io_process_write</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Writes serialized frame data to the socket if the write buffer is not empty
and socket is ready for writing.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#method_missing-instance_method" title="#method_missing (instance method)">- (Object) <strong>method_missing</strong>(meth, *args, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Checks if the missing method ends with &#8216;_frame&#8217;, and if so
raises a <span class='object_link'><a href="../UnsupportedCommandError.html" title="OnStomp::UnsupportedCommandError (class)">UnsupportedCommandError</a></span> exception.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#push_write_buffer-instance_method" title="#push_write_buffer (instance method)">- (Object) <strong>push_write_buffer</strong>(data, frame) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Adds data and frame pair to the end of the write buffer.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shift_write_buffer-instance_method" title="#shift_write_buffer (instance method)">- (Object) <strong>shift_write_buffer</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Removes the first data and frame pair from the write buffer.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#unshift_write_buffer-instance_method" title="#unshift_write_buffer (instance method)">- (Object) <strong>unshift_write_buffer</strong>(data, frame) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Adds the remains of data and frame pair to the head of the write buffer.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write_frame_nonblock-instance_method" title="#write_frame_nonblock (instance method)">- (Object) <strong>write_frame_nonblock</strong>(frame) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Serializes the given frame and adds the data to the connections internal
write buffer.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Interfaces/ConnectionEvents.html" title="OnStomp::Interfaces::ConnectionEvents (module)">Interfaces::ConnectionEvents</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Interfaces/ConnectionEvents.html#install_bindings_from_client-instance_method" title="OnStomp::Interfaces::ConnectionEvents#install_bindings_from_client (method)">#install_bindings_from_client</a></span>, <span class='object_link'><a href="../Interfaces/ConnectionEvents.html#on_closed-instance_method" title="OnStomp::Interfaces::ConnectionEvents#on_closed (method)">#on_closed</a></span>, <span class='object_link'><a href="../Interfaces/ConnectionEvents.html#on_died-instance_method" title="OnStomp::Interfaces::ConnectionEvents#on_died (method)">#on_died</a></span>, <span class='object_link'><a href="../Interfaces/ConnectionEvents.html#on_established-instance_method" title="OnStomp::Interfaces::ConnectionEvents#on_established (method)">#on_established</a></span>, <span class='object_link'><a href="../Interfaces/ConnectionEvents.html#on_terminated-instance_method" title="OnStomp::Interfaces::ConnectionEvents#on_terminated (method)">#on_terminated</a></span>, <span class='object_link'><a href="../Interfaces/ConnectionEvents.html#trigger_connection_event-instance_method" title="OnStomp::Interfaces::ConnectionEvents#trigger_connection_event (method)">#trigger_connection_event</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Interfaces/EventManager.html" title="OnStomp::Interfaces::EventManager (module)">Interfaces::EventManager</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Interfaces/EventManager.html#bind_event-instance_method" title="OnStomp::Interfaces::EventManager#bind_event (method)">#bind_event</a></span>, <span class='object_link'><a href="../Interfaces/EventManager.html#event_callbacks-instance_method" title="OnStomp::Interfaces::EventManager#event_callbacks (method)">#event_callbacks</a></span>, <span class='object_link'><a href="../Interfaces/EventManager.html#included-class_method" title="OnStomp::Interfaces::EventManager.included (method)">included</a></span>, <span class='object_link'><a href="../Interfaces/EventManager.html#trigger_event-instance_method" title="OnStomp::Interfaces::EventManager#trigger_event (method)">#trigger_event</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="OnStomp::Connections::Base (class)">Base</a></span></tt>) <strong>initialize</strong>(socket, client) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Creates a new connection using the given <span class='object_link'><a href="#socket-instance_method" title="OnStomp::Connections::Base#socket (method)">#socket</a></span> object and
<span class='object_link'><a href="../Client.html" title="OnStomp::Client (class)">client</a></span>. The <span class='object_link'><a href="#socket-instance_method" title="OnStomp::Connections::Base#socket (method)">#socket</a></span> object will generally be a
<tt>TCPSocket</tt> or an <tt>OpenSSL::SSL::SSLSocket</tt> and must support the
methods <tt>read_nonblock</tt> <tt>write_nonblock</tt>, and <tt>close</tt>.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>TCPSocket</tt>, <tt>OpenSSL::SSL::SSLSocket</tt>)</span>
      
      
        <span class='name'>socket</span>
      
      
      
    </li>
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../Client.html" title="OnStomp::Client (class)">OnStomp::Client</a></span></tt>)</span>
      
      
        <span class='name'>client</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


21
22
23
24
25
26
27
28
29</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 21</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span> <span class='id socket'>socket</span><span class='comma'>,</span> <span class='id client'>client</span>
  <span class='ivar'>@socket</span> <span class='op'>=</span> <span class='id socket'>socket</span>
  <span class='ivar'>@write_mutex</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id new'>new</span>
  <span class='ivar'>@closing</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@write_buffer</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@read_buffer</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@client</span> <span class='op'>=</span> <span class='id client'>client</span>
  <span class='ivar'>@connection_up</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>
<div id="method_missing_details" class="method_details_list">
  <h2>Dynamic Method Handling</h2>
  <p class="notice this">
    This class handles dynamic methods through the <tt>method_missing</tt> method
    
  </p>
  
    <div class="method_details first">
  <p class="signature first" id="method_missing-instance_method">
  
    - (<tt>Object</tt>) <strong>method_missing</strong>(meth, *args, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Checks if the missing method ends with &#8216;_frame&#8217;, and if so
raises a <span class='object_link'><a href="../UnsupportedCommandError.html" title="OnStomp::UnsupportedCommandError (class)">UnsupportedCommandError</a></span> exception.
</p>


  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../UnsupportedCommandError.html" title="OnStomp::UnsupportedCommandError (class)">OnStomp::UnsupportedCommandError</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


88
89
90
91
92
93
94</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 88</span>

<span class='kw'>def</span> <span class='id method_missing'>method_missing</span> <span class='id meth'>meth</span><span class='comma'>,</span> <span class='op'>*</span><span class='id args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span>
  <span class='kw'>if</span> <span class='id meth'>meth</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(.*)_frame$</span><span class='regexp_end'>/</span></span>
    <span class='id raise'>raise</span> <span class='const'>OnStomp</span><span class='op'>::</span><span class='const'>UnsupportedCommandError</span><span class='comma'>,</span> <span class='backref'>$1</span><span class='period'>.</span><span class='id upcase'>upcase</span>
  <span class='kw'>else</span>
    <span class='kw'>super</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <span id="client-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="client-instance_method">
  
    - (<tt>Object</tt>) <strong>client</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute client
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


6
7
8</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 6</span>

<span class='kw'>def</span> <span class='id client'>client</span>
  <span class='ivar'>@client</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="last_received_at-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="last_received_at-instance_method">
  
    - (<tt>Object</tt>) <strong>last_received_at</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute last_received_at
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


7
8
9</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 7</span>

<span class='kw'>def</span> <span class='id last_received_at'>last_received_at</span>
  <span class='ivar'>@last_received_at</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="last_transmitted_at-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="last_transmitted_at-instance_method">
  
    - (<tt>Object</tt>) <strong>last_transmitted_at</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute last_transmitted_at
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


7
8
9</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 7</span>

<span class='kw'>def</span> <span class='id last_transmitted_at'>last_transmitted_at</span>
  <span class='ivar'>@last_transmitted_at</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="socket-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="socket-instance_method">
  
    - (<tt>Object</tt>) <strong>socket</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute socket
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


6
7
8</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 6</span>

<span class='kw'>def</span> <span class='id socket'>socket</span>
  <span class='ivar'>@socket</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="version-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="version-instance_method">
  
    - (<tt>Object</tt>) <strong>version</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute version
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


6
7
8</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 6</span>

<span class='kw'>def</span> <span class='id version'>version</span>
  <span class='ivar'>@version</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="close-instance_method">
  
    - (<tt>Object</tt>) <strong>close</strong>(blocking = false) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Closes the <span class='object_link'><a href="#socket-instance_method" title="OnStomp::Connections::Base#socket (method)">#socket</a></span>. If <tt>blocking</tt> is true, the socket will be
closed immediately, otherwies the socket will remain open until
<span class='object_link'><a href="#io_process_write-instance_method" title="OnStomp::Connections::Base#io_process_write (method)">#io_process_write</a></span> has finished writing all of its buffered data. Once
this method has been invoked, <span class='object_link'><a href="#write_frame_nonblock-instance_method" title="OnStomp::Connections::Base#write_frame_nonblock (method)">#write_frame_nonblock</a></span> will not enqueue any
additional frames for writing.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
        <span class='name'>blocking</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


55
56
57
58
59
60
61</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 55</span>

<span class='kw'>def</span> <span class='id close'>close</span> <span class='id blocking'>blocking</span><span class='op'>=</span><span class='kw'>false</span>
  <span class='ivar'>@write_mutex</span><span class='period'>.</span><span class='id synchronize'>synchronize</span> <span class='lbrace'>{</span> <span class='ivar'>@closing</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='rbrace'>}</span>
  <span class='kw'>if</span> <span class='id blocking'>blocking</span>
    <span class='id io_process_write'>io_process_write</span> <span class='kw'>until</span> <span class='ivar'>@write_buffer</span><span class='period'>.</span><span class='id empty?'>empty?</span>
    <span class='id socket'>socket</span><span class='period'>.</span><span class='id close'>close</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="configure-instance_method">
  
    - (<tt>Object</tt>) <strong>configure</strong>(connected, con_cbs) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Performs any necessary configuration of the connection from the CONNECTED
frame sent by the broker and a <tt>Hash</tt> of pending callbacks. This
method is called after the protocol negotiation has taken place between
client and broker, and the connection that receives it will be the
connection used by the client for the duration of the session.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../Components/Frame.html" title="OnStomp::Components::Frame (class)">OnStomp::Components::Frame</a></span></tt>)</span>
      
      
        <span class='name'>connected</span>
      
      
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>{Symbol =&gt; Proc}</tt>)</span>
      
      
        <span class='name'>con_cbs</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


38
39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 38</span>

<span class='kw'>def</span> <span class='id configure'>configure</span> <span class='id connected'>connected</span><span class='comma'>,</span> <span class='id con_cbs'>con_cbs</span>
  <span class='ivar'>@version</span> <span class='op'>=</span> <span class='id connected'>connected</span><span class='period'>.</span><span class='id header?'>header?</span><span class='lparen'>(</span><span class='symbol'>:version</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id connected'>connected</span><span class='lbracket'>[</span><span class='symbol'>:version</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>1.0</span><span class='tstring_end'>'</span></span>
  <span class='id install_bindings_from_client'>install_bindings_from_client</span> <span class='id con_cbs'>con_cbs</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="connect-instance_method">
  
    - (<tt>Object</tt>) <strong>connect</strong>(client, *headers) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Exchanges the CONNECT/CONNECTED frame handshake with the broker and returns
the version detected along with the received CONNECTED frame. The supplied
list of headers will be merged into the CONNECT frame sent to the broker.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../Client.html" title="OnStomp::Client (class)">OnStomp::Client</a></span></tt>)</span>
      
      
        <span class='name'>client</span>
      
      
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
        <span class='name'>headers</span>
      
      
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../ConnectFailedError.html" title="OnStomp::ConnectFailedError (class)">OnStomp::ConnectFailedError</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 68</span>

<span class='kw'>def</span> <span class='id connect'>connect</span> <span class='id client'>client</span><span class='comma'>,</span> <span class='op'>*</span><span class='id headers'>headers</span>
  <span class='id write_frame_nonblock'>write_frame_nonblock</span> <span class='id connect_frame'>connect_frame</span><span class='lparen'>(</span><span class='op'>*</span><span class='id headers'>headers</span><span class='rparen'>)</span>
  <span class='id client_con'>client_con</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>until</span> <span class='id client_con'>client_con</span>
    <span class='id io_process_write'>io_process_write</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id f'>f</span><span class='op'>|</span> <span class='id client_con'>client_con</span> <span class='op'>||=</span> <span class='id f'>f</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id broker_con'>broker_con</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>until</span> <span class='id broker_con'>broker_con</span>
    <span class='id io_process_read'>io_process_read</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id f'>f</span><span class='op'>|</span> <span class='id broker_con'>broker_con</span> <span class='op'>||=</span> <span class='id f'>f</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id raise'>raise</span> <span class='const'>OnStomp</span><span class='op'>::</span><span class='const'>ConnectFailedError</span> <span class='kw'>if</span> <span class='id broker_con'>broker_con</span><span class='period'>.</span><span class='id command'>command</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>CONNECTED</span><span class='tstring_end'>'</span></span>
  <span class='id vers'>vers</span> <span class='op'>=</span> <span class='id broker_con'>broker_con</span><span class='period'>.</span><span class='id header?'>header?</span><span class='lparen'>(</span><span class='symbol'>:version</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id broker_con'>broker_con</span><span class='lbracket'>[</span><span class='symbol'>:version</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>1.0</span><span class='tstring_end'>'</span></span>
  <span class='id raise'>raise</span> <span class='const'>OnStomp</span><span class='op'>::</span><span class='const'>UnsupportedProtocolVersionError</span><span class='comma'>,</span> <span class='id vers'>vers</span> <span class='kw'>unless</span> <span class='id client'>client</span><span class='period'>.</span><span class='id versions'>versions</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span><span class='id vers'>vers</span><span class='rparen'>)</span>
  <span class='ivar'>@connection_up</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='lbracket'>[</span> <span class='id vers'>vers</span><span class='comma'>,</span> <span class='id broker_con'>broker_con</span> <span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="connected?-instance_method">
  
    - (<tt>true</tt>, <tt>false</tt>) <strong>connected?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns true if the socket has not been closed, false otherwise.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 45</span>

<span class='kw'>def</span> <span class='id connected?'>connected?</span>
  <span class='op'>!</span><span class='id socket'>socket</span><span class='period'>.</span><span class='id closed?'>closed?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="flush_write_buffer-instance_method">
  
    - (<tt>Object</tt>) <strong>flush_write_buffer</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Flushes the write buffer by invoking <span class='object_link'><a href="#io_process_write-instance_method" title="OnStomp::Connections::Base#io_process_write (method)">#io_process_write</a></span> until the buffer
is empty.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


98
99
100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 98</span>

<span class='kw'>def</span> <span class='id flush_write_buffer'>flush_write_buffer</span>
  <span class='id io_process_write'>io_process_write</span> <span class='kw'>until</span> <span class='ivar'>@write_buffer</span><span class='period'>.</span><span class='id empty?'>empty?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="io_process-instance_method">
  
    - (<tt>Object</tt>) <strong>io_process</strong>(&amp;cb) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Makes a single call to <span class='object_link'><a href="#io_process_write-instance_method" title="OnStomp::Connections::Base#io_process_write (method)">#io_process_write</a></span> and a single call to
<span class='object_link'><a href="#io_process_read-instance_method" title="OnStomp::Connections::Base#io_process_read (method)">#io_process_read</a></span>
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


104
105
106
107
108
109
110</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 104</span>

<span class='kw'>def</span> <span class='id io_process'>io_process</span> <span class='op'>&amp;</span><span class='id cb'>cb</span>
  <span class='id io_process_write'>io_process_write</span> <span class='op'>&amp;</span><span class='id cb'>cb</span>
  <span class='id io_process_read'>io_process_read</span> <span class='op'>&amp;</span><span class='id cb'>cb</span>
  <span class='kw'>if</span> <span class='ivar'>@connection_up</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id connected?'>connected?</span>
    <span class='id triggered_close'>triggered_close</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>connection timed out</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:died</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="io_process_read-instance_method">
  
    - (<tt>Object</tt>) <strong>io_process_read</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Reads serialized frame data from the socket if we&#8217;re connected and
and the socket is ready for reading.  The received data will be pushed to
the end of a read buffer, which is then sent to the connection&#8217;s
<span class='object_link'><a href="Serializers.html" title="OnStomp::Connections::Serializers (module)">serializer</a></span> for processing.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 185</span>

<span class='kw'>def</span> <span class='id io_process_read'>io_process_read</span>
  <span class='kw'>if</span> <span class='id connected?'>connected?</span> <span class='op'>&amp;&amp;</span> <span class='const'>IO</span><span class='period'>.</span><span class='id select'>select</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id socket'>socket</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='float'>0.1</span><span class='rparen'>)</span>
    <span class='kw'>begin</span>
      <span class='id data'>data</span> <span class='op'>=</span> <span class='id socket'>socket</span><span class='period'>.</span><span class='id read_nonblock'>read_nonblock</span><span class='lparen'>(</span><span class='const'>MAX_BYTES_PER_READ</span><span class='rparen'>)</span>
      <span class='ivar'>@read_buffer</span> <span class='op'>&lt;&lt;</span> <span class='id data'>data</span>
      <span class='ivar'>@last_received_at</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id now'>now</span>
      <span class='id serializer'>serializer</span><span class='period'>.</span><span class='id bytes_to_frame'>bytes_to_frame</span><span class='lparen'>(</span><span class='ivar'>@read_buffer</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id frame'>frame</span><span class='op'>|</span>
        <span class='kw'>yield</span> <span class='id frame'>frame</span> <span class='kw'>if</span> <span class='id block_given?'>block_given?</span>
        <span class='id client'>client</span><span class='period'>.</span><span class='id dispatch_received'>dispatch_received</span> <span class='id frame'>frame</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EINTR</span><span class='comma'>,</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EAGAIN</span><span class='comma'>,</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EWOULDBLOCK</span>
      <span class='comment'># do not
</span>    <span class='kw'>rescue</span> <span class='const'>EOFError</span>
      <span class='id triggered_close'>triggered_close</span> <span class='gvar'>$!</span><span class='period'>.</span><span class='id message'>message</span>
    <span class='kw'>rescue</span> <span class='const'>Exception</span>
      <span class='id triggered_close'>triggered_close</span> <span class='gvar'>$!</span><span class='period'>.</span><span class='id message'>message</span><span class='comma'>,</span> <span class='symbol'>:terminated</span>
      <span class='id raise'>raise</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="io_process_write-instance_method">
  
    - (<tt>Object</tt>) <strong>io_process_write</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Writes serialized frame data to the socket if the write buffer is not empty
and socket is ready for writing. Once a complete frame has been written,
this method will call <span class='object_link'><a href="../Client.html#dispatch_transmitted-instance_method" title="OnStomp::Client#dispatch_transmitted (method)">OnStomp::Client#dispatch_transmitted</a></span> to notify the
client that the frame has been sent to the broker. If a complete frame
cannot be written without blocking, the unsent data is sent to the head of
the write buffer to be processed first the next time this method is
invoked.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 148</span>

<span class='kw'>def</span> <span class='id io_process_write'>io_process_write</span>
  <span class='kw'>if</span> <span class='ivar'>@write_buffer</span><span class='period'>.</span><span class='id length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='const'>IO</span><span class='period'>.</span><span class='id select'>select</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id socket'>socket</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='float'>0.1</span><span class='rparen'>)</span>
    <span class='id to_shift'>to_shift</span> <span class='op'>=</span> <span class='ivar'>@write_buffer</span><span class='period'>.</span><span class='id length'>length</span> <span class='op'>/</span> <span class='int'>3</span>
    <span class='id written'>written</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='kw'>while</span> <span class='id written'>written</span> <span class='op'>&lt;</span> <span class='const'>MAX_BYTES_PER_WRITE</span>
      <span class='id data'>data</span><span class='comma'>,</span> <span class='id frame'>frame</span> <span class='op'>=</span> <span class='id shift_write_buffer'>shift_write_buffer</span>
      <span class='kw'>break</span> <span class='kw'>unless</span> <span class='id data'>data</span> <span class='op'>&amp;&amp;</span> <span class='id connected?'>connected?</span>
      <span class='kw'>begin</span>
        <span class='id w'>w</span> <span class='op'>=</span> <span class='id socket'>socket</span><span class='period'>.</span><span class='id write_nonblock'>write_nonblock</span><span class='lparen'>(</span><span class='id data'>data</span><span class='rparen'>)</span>
        <span class='id written'>written</span> <span class='op'>+=</span> <span class='id w'>w</span>
        <span class='ivar'>@last_transmitted_at</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id now'>now</span>
        <span class='kw'>if</span> <span class='id w'>w</span> <span class='op'>&lt;</span> <span class='id data'>data</span><span class='period'>.</span><span class='id length'>length</span>
          <span class='id unshift_write_buffer'>unshift_write_buffer</span> <span class='id data'>data</span><span class='lbracket'>[</span><span class='id w'>w</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id frame'>frame</span>
        <span class='kw'>else</span>
          <span class='kw'>yield</span> <span class='id frame'>frame</span> <span class='kw'>if</span> <span class='id block_given?'>block_given?</span>
          <span class='id client'>client</span><span class='period'>.</span><span class='id dispatch_transmitted'>dispatch_transmitted</span> <span class='id frame'>frame</span>
        <span class='kw'>end</span>
      <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EINTR</span><span class='comma'>,</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EAGAIN</span><span class='comma'>,</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EWOULDBLOCK</span>
        <span class='comment'># writing will either block, or cannot otherwise be completed,
</span>        <span class='comment'># put data back and try again some other day
</span>        <span class='id unshift_write_buffer'>unshift_write_buffer</span> <span class='id data'>data</span><span class='comma'>,</span> <span class='id frame'>frame</span>
        <span class='kw'>break</span>
      <span class='kw'>rescue</span> <span class='const'>Exception</span>
        <span class='id triggered_close'>triggered_close</span> <span class='gvar'>$!</span><span class='period'>.</span><span class='id message'>message</span><span class='comma'>,</span> <span class='symbol'>:terminated</span>
        <span class='id raise'>raise</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='ivar'>@write_buffer</span><span class='period'>.</span><span class='id empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@closing</span>
    <span class='id triggered_close'>triggered_close</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>client disconnected</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="push_write_buffer-instance_method">
  
    - (<tt>Object</tt>) <strong>push_write_buffer</strong>(data, frame) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Adds data and frame pair to the end of the write buffer
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>data</span>
      
      
      
    </li>
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../Components/Frame.html" title="OnStomp::Components::Frame (class)">OnStomp::Components::Frame</a></span></tt>)</span>
      
      
        <span class='name'></span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


123
124
125
126
127</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 123</span>

<span class='kw'>def</span> <span class='id push_write_buffer'>push_write_buffer</span> <span class='id data'>data</span><span class='comma'>,</span> <span class='id frame'>frame</span>
  <span class='ivar'>@write_mutex</span><span class='period'>.</span><span class='id synchronize'>synchronize</span> <span class='lbrace'>{</span>
    <span class='ivar'>@write_buffer</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id data'>data</span><span class='comma'>,</span> <span class='id frame'>frame</span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='ivar'>@closing</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="shift_write_buffer-instance_method">
  
    - (<tt>Object</tt>) <strong>shift_write_buffer</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Removes the first data and frame pair from the write buffer
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>data</span>
      
      
      
    </li>
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../Components/Frame.html" title="OnStomp::Components::Frame (class)">OnStomp::Components::Frame</a></span></tt>)</span>
      
      
        <span class='name'></span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


131
132
133</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 131</span>

<span class='kw'>def</span> <span class='id shift_write_buffer'>shift_write_buffer</span>
  <span class='ivar'>@write_mutex</span><span class='period'>.</span><span class='id synchronize'>synchronize</span> <span class='lbrace'>{</span> <span class='ivar'>@write_buffer</span><span class='period'>.</span><span class='id shift'>shift</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="unshift_write_buffer-instance_method">
  
    - (<tt>Object</tt>) <strong>unshift_write_buffer</strong>(data, frame) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Adds the remains of data and frame pair to the head of the write buffer
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>data</span>
      
      
      
    </li>
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../Components/Frame.html" title="OnStomp::Components::Frame (class)">OnStomp::Components::Frame</a></span></tt>)</span>
      
      
        <span class='name'></span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


137
138
139</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 137</span>

<span class='kw'>def</span> <span class='id unshift_write_buffer'>unshift_write_buffer</span> <span class='id data'>data</span><span class='comma'>,</span> <span class='id frame'>frame</span>
  <span class='ivar'>@write_mutex</span><span class='period'>.</span><span class='id synchronize'>synchronize</span> <span class='lbrace'>{</span> <span class='ivar'>@write_buffer</span><span class='period'>.</span><span class='id unshift'>unshift</span> <span class='lbracket'>[</span><span class='id data'>data</span><span class='comma'>,</span> <span class='id frame'>frame</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="write_frame_nonblock-instance_method">
  
    - (<tt>Object</tt>) <strong>write_frame_nonblock</strong>(frame) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Serializes the given frame and adds the data to the connections internal
write buffer
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../Components/Frame.html" title="OnStomp::Components::Frame (class)">OnStomp::Components::Frame</a></span></tt>)</span>
      
      
        <span class='name'>frame</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


115
116
117
118</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/onstomp/connections/base.rb', line 115</span>

<span class='kw'>def</span> <span class='id write_frame_nonblock'>write_frame_nonblock</span> <span class='id frame'>frame</span>
  <span class='id ser'>ser</span> <span class='op'>=</span> <span class='id serializer'>serializer</span><span class='period'>.</span><span class='id frame_to_bytes'>frame_to_bytes</span> <span class='id frame'>frame</span>
  <span class='id push_write_buffer'>push_write_buffer</span> <span class='id ser'>ser</span><span class='comma'>,</span> <span class='id frame'>frame</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Mon Apr  4 14:12:04 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.5 (ruby-1.9.2).
</div>

  </body>
</html>